<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detector model interface &mdash; icecube_tools v3.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Source model interface" href="source_model.html" />
    <link rel="prev" title="Data access" href="public_data_access.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> icecube_tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="public_data_access.html">Data access</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Detector model interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Effective-area,-angular-resolution-and-energy-resolution-of-10-year-data">Effective area, angular resolution and energy resolution of 10 year data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Energy-resolution">Energy resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Etrue-vs. Ereco">Etrue vs. Ereco</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Angular-resolution">Angular resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Mean-angular-uncertainty">Mean angular uncertainty</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Constructing-a-detector">Constructing a detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Time-dependent-detector">Time dependent detector</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Effective-area,-angular-resolution-and-energy-resolution-of-earlier-releases">Effective area, angular resolution and energy resolution of earlier releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Detector-model">Detector model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="source_model.html">Source model interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html#Time-dependent-simulation">Time dependent simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="point_source_likelihood.html">Point source likelihood</a></li>
<li class="toctree-l1"><a class="reference internal" href="point_source_likelihood.html#Time-dependent-point-source-analysis">Time dependent point source analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="point_source_analysis.html">MapScan</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#icecube-tools">icecube_tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">icecube_tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Detector model interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/detector_model.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Detector-model-interface">
<h1>Detector model interface<a class="headerlink" href="#Detector-model-interface" title="Permalink to this heading"></a></h1>
<p>In addition to the neutrino data itself, the IceCube collaboration provides some information about the detector that can be useful to construct simple simulations and fits. For example, the effective area is needed to connect between incident neutrino fluxes and expected number of events in the detector.</p>
<p><code class="docutils literal notranslate"><span class="pre">icecube_tools</span></code> also provides an quick interface to loading and working with such information. This is a work in progress and only certain datasets are currently implemented, such as the ones demonstrated below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from matplotlib import pyplot as plt
from matplotlib.colors import LogNorm

from icecube_tools.utils.data import IceCubeData
from icecube_tools.detector.detector import IceCube, TimeDependentIceCube
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">IceCubeData</span></code> class can be used for a quick check of the available datasets on the IceCube website.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>my_data = IceCubeData()
my_data.datasets
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;2021_03-all_data_releases.zip&#39;,
 &#39;20080911_AMANDA_7_Year_Data.zip&#39;,
 &#39;20090521_IceCube-22_Solar_WIMP_Data.zip&#39;,
 &#39;20110905_IceCube-40_String_Data.zip&#39;,
 &#39;20131121_Search_for_contained_neutrino_events_at_energies_above_30_TeV_in_2_years_of_data.zip&#39;,
 &#39;20150127_IceCube_Oscillations%20_3_years_muon_neutrino_disappearance_data.zip&#39;,
 &#39;20150219_Search_for_contained_neutrino_events_at_energies_greater_than_1_TeV_in_2_years_of_data.zip&#39;,
 &#39;20150619_IceCube-59%20_Search_for_point_sources_using_muon_events.zip&#39;,
 &#39;20150820_Astrophysical_muon_neutrino_flux_in_the_northern_sky_with_2_years_of_IceCube_data.zip&#39;,
 &#39;20151021_Observation_of_Astrophysical_Neutrinos_in_Four_Years_of_IceCube_Data.zip&#39;,
 &#39;20160105_The_79-string_IceCube_search_for_dark_matter.zip&#39;,
 &#39;20160624_Search_for_sterile_neutrinos_with_one_year_of_IceCube_data.zip&#39;,
 &#39;20161101_Search_for_point_sources_with_first_year_of_IC86_data.zip&#39;,
 &#39;20161115_A_combined_maximum-likelihood_analysis_of_the_astrophysical_neutrino_flux.zip&#39;,
 &#39;20180213_Measurement_of_atmospheric_neutrino_oscillations_with_three_years_of_data_from_the_full_sky.zip&#39;,
 &#39;20180712_IceCube_catalog_of_alert_events_up_through_IceCube-170922A.zip&#39;,
 &#39;20180712_IceCube_data_from_2008_to_2017_related_to_analysis_of_TXS_0506+056.zip&#39;,
 &#39;20181018_All-sky_point-source_IceCube_data%20_years_2010-2012.zip&#39;,
 &#39;20190515_Three-year_high-statistics_neutrino_oscillation_samples.zip&#39;,
 &#39;20190904_Bayesian_posterior_for_IceCube_7-year_point-source_search_with_neutrino-count_statistics.zip&#39;,
 &#39;20200227_All-sky_point-source_IceCube_data%20_years_2012-2015.zip&#39;,
 &#39;20200421_IceCube_Upgrade_Neutrino_Monte_Carlo_Simulation.zip&#39;,
 &#39;20200514_South_Pole_ice_temperature.zip&#39;,
 &#39;20210126_PS-IC40-IC86_VII.zip&#39;,
 &#39;20210310_IceCube_data_for_the_first_Glashow_resonance_candidate.zip&#39;,
 &#39;20211217_HESE-7-5-year-data.zip&#39;,
 &#39;20220201_Density_of_GeV_muons_in_air_showers_measured_with_IceTop.zip&#39;,
 &#39;20220902_Evidence_for_neutrino_emission_from_the_nearby_active_galaxy_NGC_1068_data.zip&#39;,
 &#39;20220913_Evidence_for_neutrino_emission_from_the_nearby_active_galaxy_NGC_1068_data.zip&#39;,
 &#39;20221028_Observation_of_High-Energy_Neutrinos_from_the_Galactic_Plane.zip&#39;,
 &#39;20221208_Observation_of_High-Energy_Neutrinos_from_the_Galactic_Plane.zip&#39;,
 &#39;ic22-solar-wimp-histograms.zip&#39;]
</pre></div></div>
</div>
<section id="Effective-area,-angular-resolution-and-energy-resolution-of-10-year-data">
<h2>Effective area, angular resolution and energy resolution of 10 year data<a class="headerlink" href="#Effective-area,-angular-resolution-and-energy-resolution-of-10-year-data" title="Permalink to this heading"></a></h2>
<p>We can now use the date string to identify certain datasets. Let’s say we want to use the effective area and angular resolution from the <code class="docutils literal notranslate"><span class="pre">20210126</span></code> dataset. If you don’t already have the dataset downloaded, <code class="docutils literal notranslate"><span class="pre">icecube_tools</span></code> will do this for you automatically. This 10 year data release provides more detailed IRF data.</p>
<p>We restrict our examples to the Northern hemisphere.</p>
<p>The simpler, earlier versions are explained afterwards.</p>
<p>The format of the effective area has not changed, though.</p>
<p>For this latest data set, we have different detector configurations available, as they changed through time (the detector was expanded). We can invoke a chosen configuration throught the second argument in <code class="docutils literal notranslate"><span class="pre">EffectiveArea.from_dataset()</span></code> for this particular data set only.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from icecube_tools.detector.r2021 import R2021IRF
from icecube_tools.detector.effective_area import EffectiveArea
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>my_aeff = EffectiveArea.from_dataset(&quot;20210126&quot;, &quot;IC86_II&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
20210126_PS-IC40-IC86_VII.zip: 100%|██████████| 39848048/39848048 [01:56&lt;00:00, 341805.26it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
h = ax.pcolor(
    my_aeff.true_energy_bins, my_aeff.cos_zenith_bins, my_aeff.values.T, norm=LogNorm()
)
cbar = fig.colorbar(h)
ax.set_xscale(&quot;log&quot;)
ax.set_xlim(1e2, 1e9)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;cos(zenith)&quot;)
cbar.set_label(&quot;Aeff [m^2]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_7_0.png" src="../_images/notebooks_detector_model_7_0.png" />
</div>
</div>
<section id="Energy-resolution">
<h3>Energy resolution<a class="headerlink" href="#Energy-resolution" title="Permalink to this heading"></a></h3>
<p>Angular resolution depends on the energy resolution. The <a class="reference external" href="https://arxiv.org/pdf/2101.09836.pdf">paper</a> accompaying the data release explains the dependency: For each bin of true energy and declination a certain amount of events is simulated. These are sorted first into bins of reconstructed energy. These are then reconstructed in terms of <code class="docutils literal notranslate"><span class="pre">PSF</span></code>(the kinematic angle between the incoming neutrino and the outgoing muon after a collision) and actual angular error. Data is given as fractional
counts in the bin <span class="math notranslate nohighlight">\((E_\mathrm{reco}, \mathrm{PSF}, \mathrm{ang\_err})\)</span> of all counts in bin (E_:nbsphinx-math:<cite>mathrm{true}</cite>, <span class="math">\delta</span>). This is nothing but a histogram, corresponding to a probability of finding an event with given true energy and true declination: <span class="math notranslate nohighlight">\(p(E_\mathrm{reco}, \mathrm{PSF}, \mathrm{ang\_err} \vert E_\mathrm{true}, \delta)\)</span>.</p>
<p>We find the energy resolution, i.e. <span class="math notranslate nohighlight">\(p(E_\mathrm{reco} \vert E_\mathrm{true}, \delta)\)</span>, by summing over (marginalising over) all entries of <span class="math notranslate nohighlight">\(\mathrm{PSF}, \mathrm{ang\_err}\)</span> for the reconstructed energy we are interested in.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">R2021IRF()</span></code>class is able to do so:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>irf = R2021IRF.from_period(&quot;IC86_II&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
idx = [0, 3, 6, 9, 12]
# plotting Ereco for different true energy bins, the declination bin here is always from +10 to +90 degrees.
for i in idx:

    x = np.linspace(*irf.reco_energy[i, 2].support(), num=1000)
    ax.plot(x, irf.reco_energy[i, 2].pdf(x), label=irf.true_energy_bins[i])
ax.legend()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe6972008e0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_10_1.png" src="../_images/notebooks_detector_model_10_1.png" />
</div>
</div>
<p>This should look like the Fig.4, left panel, of the mentioned paper, the y-axis is only scaled by a constant factor, corresponding to a properly normalised distribution. On this topic, it should be mentioned that the quantities distributed according to these histograms are the logarithms of reconstructed energy, PSF and angular uncertainty! Accordingly, logarithmic quantities are drawn as samples and only exponentiated for calculations and final data products.</p>
</section>
<section id="Etrue-vs. Ereco">
<h3>Etrue vs. Ereco<a class="headerlink" href="#Etrue-vs. Ereco" title="Permalink to this heading"></a></h3>
<p>Below, a colormap of the conditional probability <span class="math notranslate nohighlight">\(P(E_\mathrm{reco} \vert E_\mathrm{true})\)</span> is shown. It is normalised for each Etrue bin.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>etrue = irf.true_energy_bins
ereco = np.linspace(1, 8, num=100)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>vals = np.zeros((etrue.size - 1, ereco.size - 1))
for c, et in enumerate(etrue[:-1]):
    vals[c, :] = irf.reco_energy[c, 2].pdf(ereco[:-1])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
h = ax.pcolor(np.power(10, etrue), np.power(10, ereco), vals.T, norm=LogNorm())
cbar = fig.colorbar(h)
ax.set_xlim(1e2, 1e9)
ax.set_ylim(1e1, 1e8)
ax.set_xscale(&quot;log&quot;)
ax.set_yscale(&quot;log&quot;)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;Reconstructed energy [GeV]&quot;)
cbar.set_label(&quot;P(Ereco|Etrue)&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_15_0.png" src="../_images/notebooks_detector_model_15_0.png" />
</div>
</div>
</section>
<section id="Angular-resolution">
<h3>Angular resolution<a class="headerlink" href="#Angular-resolution" title="Permalink to this heading"></a></h3>
<p>Now that we have the reconstructed energy for an event with some <span class="math notranslate nohighlight">\(E_\mathrm{true}, \delta\)</span>, we can proceed in finding the angular resolution.</p>
<p>First, from the given “history” of the event, we sample the matching distribution/histogram of <span class="math notranslate nohighlight">\(\mathrm{PSF}\)</span>, again by marginalising over the uninteresting quantities, in this case only <span class="math notranslate nohighlight">\(\mathrm{ang\_err}\)</span>. We thus sample a value of <span class="math notranslate nohighlight">\(\mathrm{PSF}\)</span>, to whom a distribution of <span class="math notranslate nohighlight">\(\mathrm{ang\_err}\)</span> belongs, which we subsequently sample. This is now to be understood as a cone of a given angular radius, within which the true arrival direction lies with a probability of 50%.</p>
<p>For both steps, the histograms are created by <code class="docutils literal notranslate"><span class="pre">R2021IRF()</span></code> when instructed to do so: we pass a tuple of vectors (ra, dec) in radians and a vector of <span class="math notranslate nohighlight">\(\log_{10}(E_\mathrm{true})\)</span> to the method <code class="docutils literal notranslate"><span class="pre">sample()</span></code>. Returned are sampled ra, dec (both in radians), angular error (68%, in degrees) and reconstructed energy in GeV.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>irf.sample((np.full(4, np.pi), np.full(4, np.pi / 4)), np.full(4, 2))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([3.14887446, 3.10001048, 3.14753767, 3.1396351 ]),
 array([0.78077983, 0.79207787, 0.78351181, 0.76663935]),
 array([1.04255446, 1.51912865, 1.07743616, 2.00200961]),
 array([ 638.4537496 , 1580.39481862,  985.08856794,  837.29002682]))
</pre></div></div>
</div>
<p>If you are interested in the actual distributions, they are accessible through the attributes <code class="docutils literal notranslate"><span class="pre">R2021IRF().reco_energy</span></code> (2d numpy array storing <code class="docutils literal notranslate"><span class="pre">scipy.stats.rv_histogram</span></code> instances) and <code class="docutils literal notranslate"><span class="pre">R2021IRF().maginal_pdf_psf</span></code> (a modified ditionary class instance, indexed by a chain of keys):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>etrue_bin = 0
dec_bin = 2
ereco_bin = 10
print(irf.marginal_pdf_psf(etrue_bin, dec_bin, ereco_bin, &quot;bins&quot;))
print(irf.marginal_pdf_psf(etrue_bin, dec_bin, ereco_bin, &quot;pdf&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-3.13065092 -2.86582289 -2.60084567 -2.33592241 -2.07109231 -1.80631897
 -1.54136215 -1.27646224 -1.01153023 -0.74666199 -0.48174935 -0.21688286
  0.04805317  0.31281183  0.57772152  0.84267163  1.10754913  1.37235958
  1.63728955  1.90222053  2.1670218 ]
&lt;scipy.stats._continuous_distns.rv_histogram object at 0x7fe6971b23a0&gt;
</pre></div></div>
</div>
<p>The same works for <code class="docutils literal notranslate"><span class="pre">marginal_pdf_angerr</span></code>. The entries are only created once the <code class="docutils literal notranslate"><span class="pre">sample()</span></code> method needs to. See the class defintion of <code class="docutils literal notranslate"><span class="pre">ddict</span></code> in <code class="docutils literal notranslate"><span class="pre">icecube_tools.utils.data</span></code> for more details.</p>
</section>
<section id="Mean-angular-uncertainty">
<h3>Mean angular uncertainty<a class="headerlink" href="#Mean-angular-uncertainty" title="Permalink to this heading"></a></h3>
<p>We can find the mean angular uncertainty by sampling a large amount of events for different true energies, assuming that the average is sensibly defined as the average of logarithmic quantities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>num = 10000
loge = irf.true_energy_bins
mean_uncertainty = np.zeros(loge.shape)
for c, e in enumerate(loge[:-1]):
    _, _, samples, _ = irf.sample(
        (np.full(num, np.pi), np.full(num, np.pi / 4)), np.full(num, e)
    )
    mean_uncertainty[c] = np.power(10, np.average(np.log10(samples)))
mean_uncertainty[-1] = mean_uncertainty[-2]
plt.step(loge, mean_uncertainty, where=&quot;post&quot;)
plt.xlabel(&quot;$\log E_\mathrm{true} / \mathrm{GeV}$&quot;)
plt.ylabel(&quot;mean angular uncertainty [degrees]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;mean angular uncertainty [degrees]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_22_1.png" src="../_images/notebooks_detector_model_22_1.png" />
</div>
</div>
</section>
</section>
<section id="Constructing-a-detector">
<h2>Constructing a detector<a class="headerlink" href="#Constructing-a-detector" title="Permalink to this heading"></a></h2>
<p>A detector used for e.g. simulations can be constructed from angular/energy uncertainties and an effective area:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>detector = IceCube(my_aeff, irf, irf, &quot;IC86_II&quot;)
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">irf</span> <span class="pre">=</span> <span class="pre">R2021IRF()</span></code> is used both as spatial and energy resolution, because it encompasses both types of information and inherits from both classes.</p>
</section>
<section id="Time-dependent-detector">
<h2>Time dependent detector<a class="headerlink" href="#Time-dependent-detector" title="Permalink to this heading"></a></h2>
<p>We can construct a “meta-detector” spanning multiple data periods through the class <code class="docutils literal notranslate"><span class="pre">TimeDependentIceCube</span></code> from strings defining the data periods. Alternatively, a</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>tic = TimeDependentIceCube.from_periods(&quot;IC86_I&quot;, &quot;IC86_II&quot;)
tic.detectors
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/hostedtoolcache/Python/3.9.15/x64/lib/python3.9/site-packages/icecube_tools/detector/r2021.py:82: RuntimeWarning: divide by zero encountered in log10
  self.dataset[:, 6:-1] = np.log10(self.dataset[:, 6:-1])
Empty true energy bins at: [(0, 0), (1, 0)]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;IC86_I&#39;: &lt;icecube_tools.detector.detector.IceCube at 0x7fe6971bbee0&gt;,
 &#39;IC86_II&#39;: &lt;icecube_tools.detector.detector.IceCube at 0x7fe693e2bac0&gt;}
</pre></div></div>
</div>
<p>Available periods are</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>TimeDependentIceCube._available_periods
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;IC40&#39;, &#39;IC59&#39;, &#39;IC79&#39;, &#39;IC86_I&#39;, &#39;IC86_II&#39;]
</pre></div></div>
</div>
</section>
</section>
<section id="Effective-area,-angular-resolution-and-energy-resolution-of-earlier-releases">
<h1>Effective area, angular resolution and energy resolution of earlier releases<a class="headerlink" href="#Effective-area,-angular-resolution-and-energy-resolution-of-earlier-releases" title="Permalink to this heading"></a></h1>
<p>Repeating the prodecure for the <code class="docutils literal notranslate"><span class="pre">20181018</span></code> dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from icecube_tools.detector.effective_area import EffectiveArea
from icecube_tools.detector.energy_resolution import EnergyResolution
from icecube_tools.detector.angular_resolution import AngularResolution
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>my_aeff = EffectiveArea.from_dataset(&quot;20181018&quot;)
my_angres = AngularResolution.from_dataset(&quot;20181018&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
h = ax.pcolor(
    my_aeff.true_energy_bins, my_aeff.cos_zenith_bins, my_aeff.values.T, norm=LogNorm()
)
cbar = fig.colorbar(h)
ax.set_xscale(&quot;log&quot;)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;cos(zenith)&quot;)
cbar.set_label(&quot;Aeff [m^2]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_33_0.png" src="../_images/notebooks_detector_model_33_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
ax.plot(my_angres.true_energy_values, my_angres.values)
ax.set_xscale(&quot;log&quot;)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;Mean angular error [deg]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Mean angular error [deg]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_34_1.png" src="../_images/notebooks_detector_model_34_1.png" />
</div>
</div>
<p>We can also easily check what datasets are supported by the different detector information classes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>EffectiveArea.supported_datasets
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;20131121&#39;, &#39;20150820&#39;, &#39;20181018&#39;, &#39;20210126&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>AngularResolution.supported_datasets
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;20181018&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>EnergyResolution.supported_datasets
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;20150820&#39;]
</pre></div></div>
</div>
<p>If you would like to see some other datasets supported, please feel free to open an issue or contribute your own!</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">20150820</span></code> dataset, for which we also have the energy resolution available…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>my_aeff = EffectiveArea.from_dataset(&quot;20150820&quot;)
my_eres = EnergyResolution.from_dataset(&quot;20150820&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
20150820_Astrophysical_muon_neutrino_flu...: 100%|██████████| 43711022/43711022 [02:10&lt;00:00, 335334.37it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
h = ax.pcolor(
    my_aeff.true_energy_bins, my_aeff.cos_zenith_bins, my_aeff.values.T, norm=LogNorm()
)
cbar = fig.colorbar(h)
ax.set_xscale(&quot;log&quot;)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;cos(zenith)&quot;)
cbar.set_label(&quot;Aeff [m^2]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_41_0.png" src="../_images/notebooks_detector_model_41_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()
h = ax.pcolor(
    my_eres.true_energy_bins, my_eres.reco_energy_bins, my_eres.values.T, norm=LogNorm()
)
cbar = fig.colorbar(h)
ax.set_xscale(&quot;log&quot;)
ax.set_yscale(&quot;log&quot;)
ax.set_xlabel(&quot;True energy [GeV]&quot;)
ax.set_ylabel(&quot;Reconstructed energy [GeV]&quot;)
cbar.set_label(&quot;P(Ereco|Etrue)&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_detector_model_42_0.png" src="../_images/notebooks_detector_model_42_0.png" />
</div>
</div>
<section id="Detector-model">
<h2>Detector model<a class="headerlink" href="#Detector-model" title="Permalink to this heading"></a></h2>
<p>We can bring together these properties to make a detector model that can be used for simulations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from icecube_tools.detector.detector import IceCube
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>my_detector = IceCube(my_aeff, my_eres, my_angres)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="public_data_access.html" class="btn btn-neutral float-left" title="Data access" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="source_model.html" class="btn btn-neutral float-right" title="Source model interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Francesca Capel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>