<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Point source likelihood &mdash; icecube_tools v3.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MapScan" href="point_source_analysis.html" />
    <link rel="prev" title="Simulation" href="simulation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            icecube_tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="public_data_access.html">Data access</a></li>
<li class="toctree-l1"><a class="reference internal" href="detector_model.html">Detector model interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="detector_model.html#Effective-area,-angular-resolution-and-energy-resolution-of-earlier-releases">Effective area, angular resolution and energy resolution of earlier releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="source_model.html">Source model interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html#Time-dependent-simulation">Time dependent simulation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Point source likelihood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Spatial-likelihood">Spatial likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Energy-likelihood">Energy likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Point source likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Point-source-search">Point source search</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Time-dependent-point-source-analysis">Time dependent point source analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="point_source_analysis.html">MapScan</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#icecube-tools">icecube_tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">icecube_tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Point source likelihood</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/point_source_likelihood.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Point-source-likelihood">
<h1>Point source likelihood<a class="headerlink" href="#Point-source-likelihood" title="Permalink to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">icecube_tools</span></code> also provides an interface to the likelihoods often used in point source searches of the neutrino data (see <a class="reference external" href="https://arxiv.org/abs/0801.1604">this paper</a> by Braun et al.).</p>
<div class="math notranslate nohighlight">
\[\mathcal{L} = \prod_{i=1}^N \Bigg[ \frac{n_s}{N} \mathcal{S}(\theta_i, E_i, \gamma) + (1-\frac{n_s}{N}) \mathcal{B}(\theta_i, E_i) \Bigg],\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the total number of detected neutrino events, <span class="math notranslate nohighlight">\(n_s\)</span> is the expected number of source events, <span class="math notranslate nohighlight">\(\theta\)</span> is the neutrino direction, <span class="math notranslate nohighlight">\(E\)</span> is the reconstructed neutrino energy and <span class="math notranslate nohighlight">\(\gamma\)</span> is the source spectral index.</p>
<p>The point source likelihood is a mixture model with two components: one representing possible astrophysical neutrino sources, <span class="math notranslate nohighlight">\(\mathcal{S}(\theta, E)\)</span>, and the other known background, <span class="math notranslate nohighlight">\(\mathcal{B}(\theta, E)\)</span>. Each component has terms depending on the directional or spatial source–neutrino relationship and also the energy of the neutrinos, as higher energy neutrinos are more likely to come from astrophysical sources. Depending on the search, the energy dependence may be omitted.
Also, there may be a temporal dependence added, but this is not yet implemented in <code class="docutils literal notranslate"><span class="pre">icecube_tools</span></code>.</p>
<p>Here we implement a simple likelihood and apply it to some simulated data. There are several likelihoods available, and more information can be found in the API documentation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="kn">from</span> <span class="nn">icecube_tools.point_source_likelihood.spatial_likelihood</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EventDependentSpatialGaussianLikelihood</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">icecube_tools.point_source_likelihood.energy_likelihood</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MarginalisedEnergyLikelihood2021</span><span class="p">,</span>
    <span class="n">read_input_from_file</span><span class="p">,</span>
    <span class="n">MarginalisedIntegratedEnergyLikelihood</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">icecube_tools.point_source_likelihood.point_source_likelihood</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PointSourceLikelihood</span><span class="p">,</span>
    <span class="n">TimeDependentPointSourceLikelihood</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">icecube_tools.detector.effective_area</span> <span class="kn">import</span> <span class="n">EffectiveArea</span>
<span class="kn">from</span> <span class="nn">icecube_tools.detector.r2021</span> <span class="kn">import</span> <span class="n">R2021IRF</span>
<span class="kn">from</span> <span class="nn">icecube_tools.detector.detector</span> <span class="kn">import</span> <span class="n">IceCube</span>
<span class="kn">from</span> <span class="nn">icecube_tools.utils.data</span> <span class="kn">import</span> <span class="n">Events</span><span class="p">,</span> <span class="n">SimEvents</span><span class="p">,</span> <span class="n">RealEvents</span>
</pre></div>
</div>
</div>
<section id="Spatial-likelihood">
<h2>Spatial likelihood<a class="headerlink" href="#Spatial-likelihood" title="Permalink to this heading"></a></h2>
<p>We can start with the spatial/directional term. Let’s use the energy dependent spatial likelihood. It is build from a Gaussian with an event-wise uncertainty sampled from the IRF data. The background case will simply be an isotropic distribution on the sphere.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">angular_resolution</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">spatial_likelihood</span> <span class="o">=</span> <span class="n">EventDependentSpatialGaussianLikelihood</span><span class="p">(</span><span class="n">angular_resolution</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We show the likelihood profile for a single event with an assumed uncertainty of 1 degree.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
<span class="n">test_ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">test_dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">100</span><span class="p">),</span> <span class="n">source_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">test_ra</span><span class="p">),</span> <span class="n">spatial_likelihood</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">test_ra</span><span class="p">,</span> <span class="n">test_dec</span><span class="p">,</span> <span class="n">source_coord</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">source_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Source location&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Spatial likelihood&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f0d74d24fd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_6_1.png" src="../_images/notebooks_point_source_likelihood_6_1.png" />
</div>
</div>
</section>
<section id="Energy-likelihood">
<h2>Energy likelihood<a class="headerlink" href="#Energy-likelihood" title="Permalink to this heading"></a></h2>
<p>Now let’s think about the energy-dependent term. The way this is handled is to marginalise over the true neutrino energies, to directly connect the reconstructed neutrino energies to the spectral index of a simple power-law source model.</p>
<p>Doing this properly requires a knowledge of the relationship between the true and reconstructed energies as well as the details of the power law model. The most straightforward way to implement this is to simulate the a large number of events using the <code class="docutils literal notranslate"><span class="pre">Simulator</span></code> and build a likelihood using the output of this simulation and <code class="docutils literal notranslate"><span class="pre">MarginalisedEnergyLikelihoodFromSim</span></code>. We do exactly this with pre-computed lists of events, to be found in the data subdirectory: <code class="docutils literal notranslate"><span class="pre">sim_output_{index}.h5</span></code>. These were
simulated using point sources with spectral index <code class="docutils literal notranslate"><span class="pre">index</span></code> at 45 degrees declination. The likelihood is restricted to a small band of declination around the assumed source. Using the same declination for our test source, this is fine. For different source declinations further simulations would be needed to account for the declination dependence of the detector acceptance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aeff</span> <span class="o">=</span> <span class="n">EffectiveArea</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="s2">&quot;20210126&quot;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">)</span>
<span class="n">irf</span> <span class="o">=</span> <span class="n">R2021IRF</span><span class="o">.</span><span class="n">from_period</span><span class="p">(</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">)</span>
<span class="c1"># new_reco_bins = irf.reco_energy_bins[12, 2]</span>
<span class="n">new_reco_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">IceCube</span><span class="o">.</span><span class="n">from_period</span><span class="p">(</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">)</span>
<span class="n">energy_likelihood</span> <span class="o">=</span> <span class="n">MarginalisedIntegratedEnergyLikelihood</span><span class="p">(</span>
    <span class="s2">&quot;IC86_II&quot;</span><span class="p">,</span> <span class="n">new_reco_bins</span><span class="p">,</span> <span class="n">max_index</span><span class="o">=</span><span class="mf">4.5</span>
<span class="p">)</span>
<span class="c1"># energy_likelihood = MarginalisedEnergyLikelihood2021([1.5, 2.0, 2.5, 3.0, 3.5, 3.7, 4.0], &#39;data&#39;, &#39;sim_output&#39;, np.pi/4,)</span>
<span class="c1"># the likelihood class is backwardscompatible with the &quot;older&quot; simulation-based energy likelihood</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Resetting rng
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_reco_bins</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1.        , 1.33333333, 1.66666667, 2.        , 2.33333333,
       2.66666667, 3.        , 3.33333333, 3.66666667, 4.        ,
       4.33333333, 4.66666667, 5.        , 5.33333333, 5.66666667,
       6.        , 6.33333333, 6.66666667, 7.        , 7.33333333,
       7.66666667, 8.        , 8.33333333, 8.66666667, 9.        ])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test_energies = np.geomspace(10, 1e7) # GeV</span>
<span class="n">test_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">7.66</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">test_indices</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">energy</span><span class="p">,</span>
        <span class="n">energy_likelihood</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">))),</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;E_reco [GeV]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy likelihood&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f0d6fde0700&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_11_1.png" src="../_images/notebooks_point_source_likelihood_11_1.png" />
</div>
</div>
</section>
<section id="id1">
<h2>Point source likelihood<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Now we can bring together the spatial and energy terms to build a full <code class="docutils literal notranslate"><span class="pre">PointSourceLikelihood</span></code>. First, let’s load some data from the simulation notebook to allow us to demonstrate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">SimEvents</span><span class="o">.</span><span class="n">load_from_h5</span><span class="p">(</span><span class="s2">&quot;h5_test.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:icecube_tools.utils.data:Resetting rng
</pre></div></div>
</div>
<p>Now lets put our likelihood structure and data in together, along with a proposed source location:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">PointSourceLikelihood</span><span class="p">(</span>
    <span class="n">spatial_likelihood</span><span class="p">,</span>
    <span class="n">energy_likelihood</span><span class="p">,</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">reco_energy</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ang_err</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">source_coord</span><span class="p">,</span>
    <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The likelihood will automatically select a declination band around the proposed source location. Because of the Gaussian spatial likelihood, neutrinos far from the source will have negligible contribution. We can control the width of this band with the optional argument <code class="docutils literal notranslate"><span class="pre">band_width_factor</span></code>. Let’s see how many events are there in total, in the selected declination band and in vicinity of the proposed source:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">Ntot</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">Nprime</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(204, 204, 35)
</pre></div></div>
</div>
<p>We also note that the background likelihood is implemented automatically, for more information on the options here, check out the API docs. This is just a function of energy, with a constant factor to account for the isotropic directional likelihood.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">new_reco_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_reco_bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
    <span class="n">energy</span><span class="p">,</span>
    <span class="n">energy_likelihood</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">))),</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;index 3.7&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log_</span><span class="si">{10}</span><span class="s2">{(E_\mathrm</span><span class="si">{reco}</span><span class="s2"> / \mathrm</span><span class="si">{GeV}</span><span class="s2">)}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Background likelihood&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Background likelihood&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_20_1.png" src="../_images/notebooks_point_source_likelihood_20_1.png" />
</div>
</div>
</section>
<section id="Point-source-search">
<h2>Point source search<a class="headerlink" href="#Point-source-search" title="Permalink to this heading"></a></h2>
<p>A point source search is usually carried out by defining the likelihood ratio of source and background hypotheses, then maximising this ratio as a function of <span class="math notranslate nohighlight">\(n_s\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span>. The log likelihood ratio evaluated at the maximum likelihood values is then reffered to as the <em>test statistic</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">icecube_tools</span></code> includes calculation of the test statistic, with optimisation performed by <code class="docutils literal notranslate"><span class="pre">iminuit</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">get_test_statistic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
353.07528127247383
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">_selected_energies</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
35
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">errors</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;ValueView ns=25.94357293872001 index=2.313262357603534 weight=0.0 index_astro=2.5 index_atmo=3.7&gt;,
 &lt;ErrorView ns=4.76008651386765 index=0.18908171303220578 weight=0.05 index_astro=0.1 index_atmo=0.1&gt;)
</pre></div></div>
</div>
<p>To understand the significance of this results, we would have to calculate the test statistic for a large number of background-only simulations. These could then be used to calculate a p-value. Given there is a strong point source in the simulation we used, we can expect the test stastic to be lower if we remove the source events. Let’s try this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all point source events</span>
<span class="n">ps_sel</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">source_label</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">ntot_ps_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ps_sel</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Remove them one by one and find test statistic</span>
<span class="n">test_statistics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n_rm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntot_ps_events</span><span class="p">):</span>
    <span class="n">i_keep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ntot_ps_events</span> <span class="o">-</span> <span class="n">n_rm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">ps_sel</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ps_sel</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_keep</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">new_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">events</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">period</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">key</span><span class="p">][</span><span class="o">~</span><span class="n">ps_sel</span><span class="p">]</span>

    <span class="n">new_likelihood</span> <span class="o">=</span> <span class="n">PointSourceLikelihood</span><span class="p">(</span>
        <span class="n">spatial_likelihood</span><span class="p">,</span>
        <span class="n">energy_likelihood</span><span class="p">,</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;reco_energy&quot;</span><span class="p">],</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;ang_err&quot;</span><span class="p">],</span>
        <span class="n">source_coord</span><span class="p">,</span>
        <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">new_likelihood</span><span class="o">.</span><span class="n">_bg_energy_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">test_statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_likelihood</span><span class="o">.</span><span class="n">get_test_statistic</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntot_ps_events</span><span class="p">)],</span> <span class="n">test_statistics</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of point source events in dataset&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Test statistic value&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Test statistic value&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_27_1.png" src="../_images/notebooks_point_source_likelihood_27_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">test_statistics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>So the more neutrinos are seen from a source, the easier that source is to detect.</p>
<p>Let’s have a look at the minuit object returned by <code class="docutils literal notranslate"><span class="pre">_minimize()</span></code>. In case something is off with the fit, we can use it as a starting point for debugging.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">_minimize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
┌─────────────────────────────────────────────────────────────────────────┐
│                                Migrad                                   │
├──────────────────────────────────┬──────────────────────────────────────┤
│ FCN = -176.5                     │              Nfcn = 45               │
│ EDM = 3.75e-07 (Goal: 0.0001)    │            time = 0.2 sec            │
├──────────────────────────────────┼──────────────────────────────────────┤
│          Valid Minimum           │        No Parameters at limit        │
├──────────────────────────────────┼──────────────────────────────────────┤
│ Below EDM threshold (goal x 10)  │           Below call limit           │
├───────────────┬──────────────────┼───────────┬─────────────┬────────────┤
│  Covariance   │     Hesse ok     │ Accurate  │  Pos. def.  │ Not forced │
└───────────────┴──────────────────┴───────────┴─────────────┴────────────┘
┌───┬─────────────┬───────────┬───────────┬────────────┬────────────┬─────────┬─────────┬───────┐
│   │ Name        │   Value   │ Hesse Err │ Minos Err- │ Minos Err+ │ Limit-  │ Limit+  │ Fixed │
├───┼─────────────┼───────────┼───────────┼────────────┼────────────┼─────────┼─────────┼───────┤
│ 0 │ ns          │    26     │     5     │            │            │    0    │   204   │       │
│ 1 │ index       │   2.31    │   0.19    │            │            │   1.5   │   4.5   │       │
│ 2 │ weight      │   0.00    │   0.05    │            │            │    0    │    1    │  yes  │
│ 3 │ index_astro │    2.5    │    0.1    │            │            │   1.5   │   4.5   │  yes  │
│ 4 │ index_atmo  │    3.7    │    0.1    │            │            │   1.5   │   4.5   │  yes  │
└───┴─────────────┴───────────┴───────────┴────────────┴────────────┴─────────┴─────────┴───────┘
┌─────────────┬─────────────────────────────────────────────────────────────┐
│             │          ns       index      weight index_astro  index_atmo │
├─────────────┼─────────────────────────────────────────────────────────────┤
│          ns │        22.7        0.00           0           0           0 │
│       index │        0.00       0.036        0.00        0.00        0.00 │
│      weight │           0        0.00           0           0           0 │
│ index_astro │           0        0.00           0           0           0 │
│  index_atmo │           0        0.00           0           0           0 │
└─────────────┴─────────────────────────────────────────────────────────────┘
</pre></div></div>
</div>
<p>We can also draw the likelihood profiles for <code class="docutils literal notranslate"><span class="pre">ns</span></code> and <code class="docutils literal notranslate"><span class="pre">index</span></code> and compare to the inputted values (20 source events and an index of 2.5, cf. the simulation notebook)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span><span class="s2">&quot;ns&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_32_0.png" src="../_images/notebooks_point_source_likelihood_32_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">source_label</span><span class="p">[</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
26
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span>
    <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">bound</span><span class="o">=</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_energy_likelihood</span><span class="o">.</span><span class="n">_min_index</span><span class="p">,</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_energy_likelihood</span><span class="o">.</span><span class="n">_max_index</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_34_0.png" src="../_images/notebooks_point_source_likelihood_34_0.png" />
</div>
</div>
<p>And finally have a look at the 2d likelihood profile.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_contour</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_36_0.png" src="../_images/notebooks_point_source_likelihood_36_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">index_pl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ns_pl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">14.0</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ii</span><span class="p">,</span> <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ii</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ii</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">nn</span><span class="o">.</span><span class="n">flatten</span><span class="p">())):</span>
    <span class="n">ll</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">_func_to_minimize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">index_pl</span><span class="p">,</span> <span class="n">ns_pl</span><span class="p">,</span> <span class="n">ll</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ii</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">pcol_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcol</span><span class="p">)</span>
<span class="n">pcol_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;negative loglike&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;ns&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;ns&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_37_1.png" src="../_images/notebooks_point_source_likelihood_37_1.png" />
</div>
</div>
<p>For the simulation-based energy likelihood used in the following, the profile o <code class="docutils literal notranslate"><span class="pre">index</span></code> has some edges. This is due to the interpolation done by the energy likelihood. We fed it simulation for discreet values of <code class="docutils literal notranslate"><span class="pre">index</span></code>. We cannot sensibly interpolate the likelihood of a given energy to any index, this leads to Heaviside-like discontinuities in the global (spatial + energy) likelihood. Instead, <code class="docutils literal notranslate"><span class="pre">PointSourceLikelihood</span></code> calculates the likelihood for the next simulated values of <code class="docutils literal notranslate"><span class="pre">index</span></code>,
e.g. asking for an index 2.3 would lead to 2.0 and 2.5, and interpolate linearly between the resulting likelihoods. The precision of this method can be improved by providing simulations on a denser grid of spectral indices.</p>
<p>The error provided by <code class="docutils literal notranslate"><span class="pre">migrad()</span></code> is unreasonably small.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_likelihood</span> <span class="o">=</span> <span class="n">MarginalisedEnergyLikelihood2021</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;p_IC86_II&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">energy_likelihood</span><span class="o">.</span><span class="n">_min_index</span> <span class="o">=</span> <span class="mf">1.55</span>
<span class="n">energy_likelihood</span><span class="o">.</span><span class="n">_max_index</span> <span class="o">=</span> <span class="mf">3.85</span>
<span class="n">likelihood</span> <span class="o">=</span> <span class="n">PointSourceLikelihood</span><span class="p">(</span>
    <span class="n">spatial_likelihood</span><span class="p">,</span>
    <span class="n">energy_likelihood</span><span class="p">,</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">reco_energy</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ang_err</span><span class="p">[</span><span class="n">events</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">source_coord</span><span class="p">,</span>
    <span class="n">cosz_bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">51</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">likelihood</span><span class="o">.</span><span class="n">_bg_index</span> <span class="o">=</span> <span class="mf">3.7</span>
<span class="n">likelihood</span><span class="o">.</span><span class="n">_bg_energy_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data/p_IC86_II_index_1.5.h5
data/p_IC86_II_index_1.7.h5
data/p_IC86_II_index_1.9.h5
data/p_IC86_II_index_2.1.h5
data/p_IC86_II_index_2.3.h5
data/p_IC86_II_index_2.5.h5
data/p_IC86_II_index_2.7.h5
data/p_IC86_II_index_2.9.h5
data/p_IC86_II_index_3.1.h5
data/p_IC86_II_index_3.3.h5
data/p_IC86_II_index_3.5.h5
data/p_IC86_II_index_3.7.h5
data/p_IC86_II_index_3.9.h5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">get_test_statistic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
403.3478434197606
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">_minimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span><span class="s2">&quot;ns&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_42_0.png" src="../_images/notebooks_point_source_likelihood_42_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do this because for this interpolated function minuit can&#39;t compute reliable errors</span>
<span class="n">index</span><span class="p">,</span> <span class="n">llh</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span>
    <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">bound</span><span class="o">=</span><span class="p">(</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_energy_likelihood</span><span class="o">.</span><span class="n">_min_index</span><span class="p">,</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_energy_likelihood</span><span class="o">.</span><span class="n">_max_index</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">lower_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
    <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">llh</span><span class="p">[:</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">llh</span> <span class="o">==</span> <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">index</span><span class="p">[:</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">llh</span> <span class="o">==</span> <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span>
<span class="p">)</span>
<span class="n">upper_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
    <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">llh</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">llh</span> <span class="o">==</span> <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:],</span>
    <span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">llh</span> <span class="o">==</span> <span class="n">llh</span><span class="o">.</span><span class="n">min</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:],</span>
<span class="p">)</span>
<span class="n">lims</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
    <span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lower_lim</span><span class="p">,</span> <span class="n">upper_lim</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;index = </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">lower_lim</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">upper_lim</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;index = 2.3 - 0.2 + 0.2&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_43_1.png" src="../_images/notebooks_point_source_likelihood_43_1.png" />
</div>
</div>
</section>
</section>
<section id="Time-dependent-point-source-analysis">
<h1>Time dependent point source analysis<a class="headerlink" href="#Time-dependent-point-source-analysis" title="Permalink to this heading"></a></h1>
<p>Encompassing multiple data seasons, although shown only for one (the same as above), uses a single <code class="docutils literal notranslate"><span class="pre">ns</span></code>, which is distributed among the seasons with the number of expected events for <code class="docutils literal notranslate"><span class="pre">gamma</span></code> and the provided observational times (<code class="docutils literal notranslate"><span class="pre">times</span></code>) as relative weight.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">SimEvents</span><span class="o">.</span><span class="n">load_from_h5</span><span class="p">(</span><span class="s2">&quot;h5_test.hdf5&quot;</span><span class="p">)</span>
<span class="n">source_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
<span class="c1"># energy_likelihood = MarginalisedIntegratedEnergyLikelihood(irf, aeff, new_reco_bins)</span>
<span class="c1"># index_list = list(np.arange(1.5, 4.25, 0.25))</span>
<span class="n">tllh</span> <span class="o">=</span> <span class="n">TimeDependentPointSourceLikelihood</span><span class="p">(</span>
    <span class="n">source_coords</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">],</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span>
    <span class="n">events</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span>
    <span class="n">events</span><span class="o">.</span><span class="n">reco_energy</span><span class="p">,</span>
    <span class="n">events</span><span class="o">.</span><span class="n">ang_err</span><span class="p">,</span>
    <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">times</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;IC86_II&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">band_width_factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">tllh</span><span class="o">.</span><span class="n">_minimize</span><span class="p">()</span>

<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:icecube_tools.utils.data:Resetting rng
WARNING:icecube_tools.utils.data:Resetting rng
WARNING:icecube_tools.utils.data:Resetting rng
WARNING:icecube_tools.utils.data:Resetting rng
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
    <tr>
        <th colspan="5" style="text-align:center" title="Minimizer"> Migrad </th>
    </tr>
    <tr>
        <td colspan="2" style="text-align:left" title="Minimum value of function"> FCN = -165.1 </td>
        <td colspan="3" style="text-align:center" title="Total number of function and (optional) gradient evaluations"> Nfcn = 63 </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:left" title="Estimated distance to minimum and goal"> EDM = 1.52e-06 (Goal: 0.0001) </td>
        <td colspan="3" style="text-align:center" title="Total run time of algorithms"> time = 0.3 sec </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:center;background-color:#92CCA6;color:black"> Valid Minimum </td>
        <td colspan="3" style="text-align:center;background-color:#92CCA6;color:black"> No Parameters at limit </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:center;background-color:#92CCA6;color:black"> Below EDM threshold (goal x 10) </td>
        <td colspan="3" style="text-align:center;background-color:#92CCA6;color:black"> Below call limit </td>
    </tr>
    <tr>
        <td style="text-align:center;background-color:#92CCA6;color:black"> Covariance </td>
        <td style="text-align:center;background-color:#92CCA6;color:black"> Hesse ok </td>
        <td style="text-align:center;background-color:#92CCA6;color:black" title="Is covariance matrix accurate?"> Accurate </td>
        <td style="text-align:center;background-color:#92CCA6;color:black" title="Is covariance matrix positive definite?"> Pos. def. </td>
        <td style="text-align:center;background-color:#92CCA6;color:black" title="Was positive definiteness enforced by Minuit?"> Not forced </td>
    </tr>
</table><table>
    <tr>
        <td></td>
        <th title="Variable name"> Name </th>
        <th title="Value of parameter"> Value </th>
        <th title="Hesse error"> Hesse Error </th>
        <th title="Minos lower error"> Minos Error- </th>
        <th title="Minos upper error"> Minos Error+ </th>
        <th title="Lower limit of the parameter"> Limit- </th>
        <th title="Upper limit of the parameter"> Limit+ </th>
        <th title="Is the parameter fixed in the fit"> Fixed </th>
    </tr>
    <tr>
        <th> 0 </th>
        <td> ns </td>
        <td> 26 </td>
        <td> 5 </td>
        <td>  </td>
        <td>  </td>
        <td> 0 </td>
        <td> 204 </td>
        <td>  </td>
    </tr>
    <tr>
        <th> 1 </th>
        <td> index </td>
        <td> 2.31 </td>
        <td> 0.19 </td>
        <td>  </td>
        <td>  </td>
        <td> 1.5 </td>
        <td> 5 </td>
        <td>  </td>
    </tr>
    <tr>
        <th> 2 </th>
        <td> weight </td>
        <td> 0.0 </td>
        <td> 0.1 </td>
        <td>  </td>
        <td>  </td>
        <td> 0 </td>
        <td> 1 </td>
        <td> yes </td>
    </tr>
    <tr>
        <th> 3 </th>
        <td> index_astro </td>
        <td> 2.5 </td>
        <td> 0.1 </td>
        <td>  </td>
        <td>  </td>
        <td> 1.5 </td>
        <td> 5 </td>
        <td> yes </td>
    </tr>
    <tr>
        <th> 4 </th>
        <td> index_atmo </td>
        <td> 3.7 </td>
        <td> 0.1 </td>
        <td>  </td>
        <td>  </td>
        <td> 1.5 </td>
        <td> 5 </td>
        <td> yes </td>
    </tr>
</table><table>
    <tr>
        <td></td>
        <th> ns </th>
        <th> index </th>
        <th> weight </th>
        <th> index_astro </th>
        <th> index_atmo </th>
    </tr>
    <tr>
        <th> ns </th>
        <td> 22.7 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
    </tr>
    <tr>
        <th> index </th>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td> 0.036 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
    </tr>
    <tr>
        <th> weight </th>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
    </tr>
    <tr>
        <th> index_astro </th>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
    </tr>
    <tr>
        <th> index_atmo </th>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0.00 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td style="background-color:rgb(250,250,250);color:black"> 0 </td>
        <td> 0 </td>
    </tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_46_0.png" src="../_images/notebooks_point_source_likelihood_46_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span><span class="s2">&quot;ns&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_47_0.png" src="../_images/notebooks_point_source_likelihood_47_0.png" />
</div>
</div>
<p>There is also a method to use only the events within the selected declination band and their energy to fit the background index. Default setting is one background index (<code class="docutils literal notranslate"><span class="pre">index_atmo</span></code>), using two at once does not lead to a converging fit right now.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tllh</span><span class="o">.</span><span class="n">_minimize_bg</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
    <tr>
        <th colspan="5" style="text-align:center" title="Minimizer"> Migrad </th>
    </tr>
    <tr>
        <td colspan="2" style="text-align:left" title="Minimum value of function"> FCN = 470.2 </td>
        <td colspan="3" style="text-align:center" title="Total number of function and (optional) gradient evaluations"> Nfcn = 76 </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:left" title="Estimated distance to minimum and goal"> EDM = 0 (Goal: 0.0001) </td>
        <td colspan="3" style="text-align:center" title="Total run time of algorithms">  </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:center;background-color:#c15ef7;color:black"> INVALID Minimum </td>
        <td colspan="3" style="text-align:center;background-color:#92CCA6;color:black"> No Parameters at limit </td>
    </tr>
    <tr>
        <td colspan="2" style="text-align:center;background-color:#92CCA6;color:black"> Below EDM threshold (goal x 10) </td>
        <td colspan="3" style="text-align:center;background-color:#92CCA6;color:black"> Below call limit </td>
    </tr>
    <tr>
        <td style="text-align:center;background-color:#92CCA6;color:black"> Covariance </td>
        <td style="text-align:center;background-color:#c15ef7;color:black"> Hesse FAILED </td>
        <td style="text-align:center;background-color:#FFF79A;color:black" title="Is covariance matrix accurate?"> APPROXIMATE </td>
        <td style="text-align:center;background-color:#c15ef7;color:black" title="Is covariance matrix positive definite?"> NOT pos. def. </td>
        <td style="text-align:center;background-color:#92CCA6;color:black" title="Was positive definiteness enforced by Minuit?"> Not forced </td>
    </tr>
</table><table>
    <tr>
        <td></td>
        <th title="Variable name"> Name </th>
        <th title="Value of parameter"> Value </th>
        <th title="Hesse error"> Hesse Error </th>
        <th title="Minos lower error"> Minos Error- </th>
        <th title="Minos upper error"> Minos Error+ </th>
        <th title="Lower limit of the parameter"> Limit- </th>
        <th title="Upper limit of the parameter"> Limit+ </th>
        <th title="Is the parameter fixed in the fit"> Fixed </th>
    </tr>
    <tr>
        <th> 0 </th>
        <td> weight </td>
        <td> 0.0 </td>
        <td> 0.1 </td>
        <td>  </td>
        <td>  </td>
        <td> 0 </td>
        <td> 1 </td>
        <td> yes </td>
    </tr>
    <tr>
        <th> 1 </th>
        <td> index_astro </td>
        <td> 2.5 </td>
        <td> 0.1 </td>
        <td>  </td>
        <td>  </td>
        <td> 1.5 </td>
        <td> 5 </td>
        <td> yes </td>
    </tr>
    <tr>
        <th> 2 </th>
        <td> index_atmo </td>
        <td> 3.3 </td>
        <td> 0.0 </td>
        <td>  </td>
        <td>  </td>
        <td> 1.5 </td>
        <td> 5 </td>
        <td>  </td>
    </tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">tllh</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">draw_profile</span><span class="p">(</span><span class="s2">&quot;index_atmo&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_point_source_likelihood_50_0.png" src="../_images/notebooks_point_source_likelihood_50_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="simulation.html" class="btn btn-neutral float-left" title="Simulation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="point_source_analysis.html" class="btn btn-neutral float-right" title="MapScan" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Francesca Capel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>